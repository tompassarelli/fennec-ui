/* 
quick reference:
#navigator-toolbox is the root container of most firefox elements
-- #nav-bar contains nav buttons (back.. refresh), urlbar, extensions
#browser is the other primary container, nav toolbox's sibling, contains sidebar

fennec's target structure:

[ header ] - #nav-bar subset: nav buttons, extensions, settings
[ urlbar ] - #nav-bar.urlbar is moved out of header and put below
[ sideberry ] - firefox extension

this css code tends to be ordered with respect to dom top-bottom, left-right 
*/

:root {
  --fennec-color: #36363a;
  --fennec-navtoolbox-mx-left: 6.5px;
  
  --fen-urlbar-alignment: calc(3px - var(--fennec-navtoolbox-mx-left));
}

/* ---------------------------------------- */

/* WORK IN PROGRES sidebar toggle:
   sideberry/history toggles the whole ui 
   if/when this is integrated, userchrome toggle is not needed */

/* the below css works if applied to browser toolbox after load,
   but trying to load this eagerly user userChrome.css
   interferes with Firefox's chrome loading pipeline 
   because we are hiding the element early, interfering
   with firefox's javascript loading the UI it seems*/

/* body:has(#sidebar-box[hidden="true"]) #navigator-toolbox {
  display: none !important;
} */

/* ---------------------------------------- */

/* style 1 - hide when all UI */
:root[titlepreface*="á Ž"] {
  #navigator-toolbox {
    display: none !important;
  }
}

/* root node of everything mozilla */
#navigator-toolbox {
  position: absolute !important;
  top: 0px;
  z-index: 2 !important;  /* 3 spills extensions on page*/
  border: none !important;
  margin-top: 4px;
  margin-left: var(--fennec-navtoolbox-mx-left);
}

/* the thing that comes up when you hold alt, there's already settings menu */
#toolbar-menubar {
  display: none;
}

/* Firefox's native tabs - always disable, depend on sideberry for tabs */
#TabsToolbar {
  display: none;
}

/* ---- s:header ---- */

/*  #nav-bar is basically fennec's header section, stubbed for structural reference */

/* #nav-bar {} */

#nav-bar-customization-target {
  background-color: var(--fennec-color);
}

/* 
   #nav-bar.children (below) 
   note: we free nav-bar.urlbar with position absolute
*/

/* sidebar toggle - hide this */
#sidebar-button {
  display: none;
}

#back-button {
  /* each nav btn is typically 32px content, 2px of padding, 36px total */
  /* what this means is that 4px seperates each button */
  /* the Panel (settings) button is 30px */
  /* if we the displacement to 34px, it would be 34-30=>4px*/
  margin-left: 34px !important;
  padding-left: 0px !important;
}

/* #forward-button {
  display: none;
}  */

/* #stop-reload-button {
} */

/* home button - hide this */
#home-button {
  display: none;
}

/* START: spring1 (deprecated)

  #customizableui-special-spring1 and 2 are spacers 
  nav buttons - spring1 - url bar - spring2 - extensions/settings
*/

#customizableui-special-spring1 {
  display: none;
}

/* END: spring1 (deprecated) */


/* child: urlbar is here, we modify it later, just reference */
/* #urlbar-container{} */


/* START: spring2 (deprecated) */


#customizableui-special-spring2 {
  display: none;
} 

/* END: spring2 (deprecated) */

/* #downloads-button {
} */

/* #unified-extensions-button {
} */

/* all pinnned extensions overflow here... */

/* settings menu */ 
#PanelUI-button {
  position: absolute !important;
  width: 30px !important;
  margin: 0px !important;
  padding: 0px !important;
}

#PanelUI-menu-button {
  width: 30px !important;
  margin: 0px !important;
  padding: 0px !important;
}

/* bookmarks area - always disable */
#PersonalToolbar {
  display: none;
}

/* ---- e:header ---- */



/* ---- s:urlbar ---- */

/* Pin Search Bar / Url bar above the sideberry tabs, and below the zen-sidebar top buttons */
#urlbar-container {
  position: absolute;
  top: 50px;
  width: 215px !important; /* probably need to use a few `has` selectors to ensure its always bigger than sidebar */
  left: var(--fen-urlbar-alignment) !important;
}

/* hide default url background unless active */
/* we use a custom background that tracks sidebar width*/
#urlbar:not(:is(
  [breakout-extend]
)) #urlbar-background {
  display: none !important;
}

/* eager width adjustments for urlbar as sidebar width changes */
/* math - aesthetically urlbar width of 215 maps to a sidebar width of 224px */
/* 224 appears to be min-width default for sidebar */

/* 200s */
body:has(#browser > #sidebar-box[width^="23"]) #urlbar-container { width: 221px !important; }
body:has(#browser > #sidebar-box[width^="23"]) #urlbar-container { width: 221px !important; }
body:has(#browser > #sidebar-box[width^="24"]) #urlbar-container { width: 231px !important; }
body:has(#browser > #sidebar-box[width^="25"]) #urlbar-container { width: 241px !important; }
body:has(#browser > #sidebar-box[width^="26"]) #urlbar-container { width: 251px !important; }
body:has(#browser > #sidebar-box[width^="27"]) #urlbar-container { width: 261px !important; }
body:has(#browser > #sidebar-box[width^="28"]) #urlbar-container { width: 271px !important; }
body:has(#browser > #sidebar-box[width^="29"]) #urlbar-container { width: 281px !important; }

/* 300s */
body:has(#browser > #sidebar-box[width^="30"]) #urlbar-container { width: 291px !important; }
body:has(#browser > #sidebar-box[width^="31"]) #urlbar-container { width: 301px !important; }
body:has(#browser > #sidebar-box[width^="32"]) #urlbar-container { width: 311px !important; }
body:has(#browser > #sidebar-box[width^="33"]) #urlbar-container { width: 321px !important; }
body:has(#browser > #sidebar-box[width^="34"]) #urlbar-container { width: 331px !important; }
body:has(#browser > #sidebar-box[width^="35"]) #urlbar-container { width: 341px !important; }
body:has(#browser > #sidebar-box[width^="36"]) #urlbar-container { width: 351px !important; }
body:has(#browser > #sidebar-box[width^="37"]) #urlbar-container { width: 361px !important; }
body:has(#browser > #sidebar-box[width^="38"]) #urlbar-container { width: 371px !important; }
body:has(#browser > #sidebar-box[width^="39"]) #urlbar-container { width: 381px !important; }

/* 400s */
body:has(#browser > #sidebar-box[width^="40"]) #urlbar-container { width: 391px !important; }
body:has(#browser > #sidebar-box[width^="41"]) #urlbar-container { width: 401px !important; }
body:has(#browser > #sidebar-box[width^="42"]) #urlbar-container { width: 411px !important; }
body:has(#browser > #sidebar-box[width^="43"]) #urlbar-container { width: 421px !important; }
body:has(#browser > #sidebar-box[width^="44"]) #urlbar-container { width: 431px !important; }
body:has(#browser > #sidebar-box[width^="45"]) #urlbar-container { width: 441px !important; }
body:has(#browser > #sidebar-box[width^="46"]) #urlbar-container { width: 451px !important; }
body:has(#browser > #sidebar-box[width^="47"]) #urlbar-container { width: 461px !important; }
body:has(#browser > #sidebar-box[width^="48"]) #urlbar-container { width: 471px !important; }
body:has(#browser > #sidebar-box[width^="49"]) #urlbar-container { width: 481px !important; }

/* 500s */
body:has(#browser > #sidebar-box[width^="50"]) #urlbar-container { width: 491px !important; }
body:has(#browser > #sidebar-box[width^="51"]) #urlbar-container { width: 501px !important; }
body:has(#browser > #sidebar-box[width^="52"]) #urlbar-container { width: 511px !important; }
body:has(#browser > #sidebar-box[width^="53"]) #urlbar-container { width: 521px !important; }
body:has(#browser > #sidebar-box[width^="54"]) #urlbar-container { width: 531px !important; }
body:has(#browser > #sidebar-box[width^="55"]) #urlbar-container { width: 541px !important; }
body:has(#browser > #sidebar-box[width^="56"]) #urlbar-container { width: 551px !important; }
body:has(#browser > #sidebar-box[width^="57"]) #urlbar-container { width: 561px !important; }
body:has(#browser > #sidebar-box[width^="58"]) #urlbar-container { width: 571px !important; }
body:has(#browser > #sidebar-box[width^="59"]) #urlbar-container { width: 581px !important; }

/* 600 */
body:has(#browser > #sidebar-box[width^="6"]) #urlbar-container { width: 591px !important; }

/* set a minimum width for the url search */
body:has(#browser > #sidebar-box[width^="2"]) #urlbar:is(
  [focused][breakout-extend]
) {
  width: 400px !important;
}

body:has(#browser > #sidebar-box[width^="3"]) #urlbar:is(
  [focused][breakout-extend]
) {
  width: 400px !important;
}
body:has(#browser > #sidebar-box[width^="4"]) #urlbar:is(
  [focused][breakout-extend]
) {
  width: 500px !important;
}
body:has(#browser > #sidebar-box[width^="5"]) #urlbar:is(
  [focused][breakout-extend]
) {
  width: 600px !important;
}

/* remove google icon crowding search bar */
#urlbar-searchmode-switcher {
  display: none;
}

/* TODO after removing search move switcher, urlbar when */
/* .urlbar-input-container {
  padding-left: 5px !important;
} */

/* shield icon for tracking protections, don't need */
/* TODO make this shown on hover, rather than always hide */
.urlbar-input-container #tracking-protection-icon-container {
  display: none;
}

/* this will show "Not secure" if the connection is not secure, 
   there is already an icon, only selectively hide if safe  */
/* #identity-icon-label {} */

#identity-box {
	transform: translateX(-0.0px);
}

/* shows Firefox if on settings, not strictly needed */
#identity-box.chromeUI #identity-icon-label {
  display: none;
}

/* shows "Sideberry" if on its extension page, not strictly needed */
/* #identity-box.extensionPage #identity-icon-label {
  display: none;
} */

/* align tab and url text - on extension page */
#identity-box.extensionPage {
  margin-right: 5px !important;
}
/* align tab and url text - when label text like not secure is present */
#identity-box #identity-icon-label {
  margin-left: 6px !important;
}

/* keep it dark, except when breakout-extend=true, maps to focused it looks like */
#urlbar:not([focused]) #identity-icon-box {
  background-color: #252528 !important;
}
#urlbar:is([breakout-extend]) #identity-icon-box {
  background-color: #38383c !important;
}

/* align url icon position with sideberry */
#identity-icon-box {
  padding-left: 5px !important;
  padding-right: 5px !important;
}

/* warn if not secure */
body:has(#identity-box.notSecure) #identity-icon-label {
  color: red;
}

/* always shown identity-icon label if not secure */
#identity-box[pageproxystate="valid"].notSecureText #identity-icon-label {
	display: block !important;
}
#identity-box[pageproxystate="valid"].notSecureText #identity-icon-box {
  flex-shrink: 0 !important;
  min-width: 125px;
}

/*
FIREFOX SECURITY STATES REFERENCE

Reasonably safe to customize:
- .chromeUI          - Firefox internal pages
- .extensionPage     - Extension pages  
- .verifiedDomain    - HTTPS with valid cert
- .verifiedIdentity  - EV certificates

Preserve these (security warnings):
- .notSecure         - HTTP or broken HTTPS
- .insecureLoginForms - HTTPS page with HTTP login
- .mixedContentBlocked - HTTPS with blocked mixed content
- .mixedActiveContent  - HTTPS with active mixed content
*/

/* hide the packlock if not hovered and only if site is secure */
/* `.mixedContentBlocked` could be worth surfacing, for warnings */
/* but it seems like .notSecure is always concerning, so we will surface that */
/* #identity-box:not(.notSecure) {
  opacity: 1;
  transform: translateX(0);
  transition: opacity 0.3s ease, transform 0.3s ease;
}
#urlbar:not(:hover) #identity-box:not(.notSecure) {
  opacity: 0;
  transform: translateX(-20px); 
  pointer-events: none;
  width: 0px;
} */

/* option to show warning if the site is not secure when sidebar is open */
/* z-index 2 is above #nav-bar, ensure we are above it */
/* body:has(#identity-box.notSecure)::before {
  content: "ðŸ¦Š Fennec UI Alerts: Not Secure";
  text-align: center;
  font-size: 24px;
  margin-left:15%;
  padding-top: 8px;
  display: block;
  position: absolute;
  z-index: 3;
  min-width: 85%;
  height: 46px;
  box-sizing: border-box;
  background-color: var(--fennec-color);
} */

/* when sidebar is hidden show warning on not secure sites */
/* style 1 - hide when all UI */
:root[titlepreface*="á Ž"] {
  body:has(#identity-box.notSecure)::before {
    content: "ðŸ¦Š Fennec UI Alerts: Not Secure";
    text-align: center;
    font-size: 24px;
    margin-left: 0px;
    display: block;
    position: inherit;
    z-index: 3;
    width: 100%;
    height: 46px;
    padding-top: 8px;
    box-sizing: border-box;
    background-color: var(--fennec-color);
  }
}

/* on right-side of urlbar, favorite button, some other things I don't care */
#page-action-buttons {
  display: none !important;
}


/* ---- e:urlbar ---- */



/* ---- s:sidebar ---- */

/* smallest width seems to be 224px */
/* style 1 - hide when all UI */
#sidebar-box {
  max-width: 600px !important;
}

:root[titlepreface*="á Ž"] {
  #sidebar-box {
    display: none !important;
  }
}

/* Remove the "Sideberry", "History", etc. sidepanel header  */
#sidebar-header {
  display: none;
}

/* create space for urlbar area inside the sidebar */
#sidebar-box::before {
  content: "";
  display: block;
  height: 100px;
  width: 100%;
  pointer-events: none;
  box-sizing: border-box;
  background-color: var(--fennec-color);
}

/* custom urlbar background so its aligned with tabs */
#sidebar-box::after {
  content: "";
  position: absolute;
  top: 58px;
  left: 6px;
  height: 32px;
  width: calc(100% - 7px);
  pointer-events: none;
  box-sizing: border-box;
  background-color: rgba(0,0,0,0.3);
  border-radius: 5px;
}

/* create a horizontal divider before icons */
.sidebar-browser-stack::before {
  content: "";
  position: fixed;
  top: 40px;
  left: 9px;
  width: 96%;
  pointer-events: none;
  box-sizing: border-box;
  border-bottom: 1px solid rgba(255,255,255,0.3) !important;
}

/* increase ::before height if notifications are live */
/* body:has(#notifications-toolbar) {
  #sidebar-box::before {
    height: 300px;
  }
} */

#notifications-toolbar {
	position: absolute;
	top: 90px;
}


/* ------ s:sidebar-border ---- */ 

/* the gutter between the sidebar and page */
#sidebar-splitter {
  margin: 0px !important;
  background-color: var(--fennec-color) !important;
  border: 0px !important;
  width: 7px !important;
}

/* style 1 - hide when all UI */
:root[titlepreface*="á Ž"] {
  #sidebar-splitter {
    display: none !important;
  }
}

/* ------ e:sidebar-border ---- */ 


/* ------ s:sideberry ---- */
/* edits are handled in sideberry css file */
/* ------ e:sideberry ---- */


/* ---- e:sidebar ---- */
