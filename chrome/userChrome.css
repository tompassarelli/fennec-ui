/* 
quick reference:
#navigator-toolbox is the root container of most firefox elements
-- #nav-bar contains nav buttons (back.. refresh), urlbar, extensions
#browser is the other primary container, nav toolbox's sibling, contains sidebar

fennec's structure:

CC - conceptual component not actually in DOM, but a layout objective

[drawer] - CC
  [ header  ] - CC | #nav-bar > buttons: settings, forward/back, refresh, extensions
  [ urlbar  ] - #nav-bar > urlbar is moved out of header and put below
  [ sidebar ] - web extensions like sideberry, bookmarks, history
[/drawer]

Style Guide

Fennec's drawer has 6px of left/right gap, set by --fen-drawer-gap-x
- the left gap is generally implemented as padding on container components in the drawer
  - examples include: navigator-toolbox, urlbar-container, sidebar-box
- the right gap is implemented by setting the sidebar-spliter (drag-line) width to gap value

code below tends to be ordered with respect to the DOM top-bottom, left-right 
*/

:root {
  --fen-color: #36363a; /* default look if no theme selected */
  
  /* padding/margin of the drawer components */
  --fen-drawer-gap-y: 6px;
  --fen-drawer-gap-x: 6px;
  --fen-header-height-y: calc(32px + 2*var(--fen-drawer-gap-y));
  
  --fen-urlbar-bg-height: 36px;
  
  /* not technically nessecary, mainly to minimize media query sprawl on constantly resizing urlbar */
  --fen-drawer-max-width: 600px;
}

/* if a theme is present, we will apply it with some sideberry opinonated overrides */
:root[lwtheme] {
  --fen-color: var(--toolbar-bgcolor);
  --sidebar-background-color: var(--toolbar-bgcolor);
}

/* ---------------------------------------- */

/* WORK COMPLETE sidebar toggle:
   toggle sidebar -> toggle the whole ui 
   userchrome toggle is no longer needed */

body:has(#sidebar-box[hidden="true"]) #navigator-toolbox {
  width: 0px !important;
}

body:has(#sidebar-box[hidden="true"]) #nav-bar toolbaritem#urlbar-container {
  width: 0px !important;
}

/* ---------------------------------------- */

/* root node of everything mozilla */
#navigator-toolbox {
  position: absolute !important;
  /* should cover the entire drawer area */
  width: calc(var(--fen-drawer-max-width) + var(--fen-drawer-gap-x));
  height: var(--fen-header-height-y);
  z-index: 2 !important;  /* 3 spills extensions onto page*/
  border: none !important;
  padding-top: var(--fen-drawer-gap-y);
  background-color: var(--fen-color) !important;
}

/* the thing that comes up when you hold alt, there's already settings menu */
#toolbar-menubar {
  display: none;
}

/* Firefox's native tabs - always disable, depend on sideberry for tabs */
#TabsToolbar {
  display: none;
}

/* ---- s:header ---- */

/*  #nav-bar is basically fennec's header section, stubbed for structural reference */

#nav-bar {
  width: calc(600px - var(--fen-drawer-gap-x));
  border-top: 0px !important;
}

#nav-bar-customization-target {
  background-color: var(--fen-color);
  min-width: calc(var(--fen-drawer-max-width) + var(--fen-drawer-gap-x)) !important;
}

/* 
   #nav-bar.children (below) 
   note: we free nav-bar.urlbar with position absolute
*/

/* sidebar toggle - hide this */
#sidebar-button {
  display: none;
}

#back-button {
  /* each nav btn is typically 32px, then 2px of padding */
  /* so we have to mock a 34px btn */
  /* so factor gap delta, then mock the btn */
  margin-left: calc(34px + var(--fen-drawer-gap-x)) !important;
  padding-left: 2px !important;
}

/* #forward-button {
  display: none;
}  */

/* #stop-reload-button {
} */

/* home button - hide this */
#home-button {
  display: none;
}

/* START: spring1 (deprecated)

  #customizableui-special-spring1 and 2 are spacers 
  nav buttons - spring1 - url bar - spring2 - extensions/settings
*/

#customizableui-special-spring1 {
  display: none;
}

/* END: spring1 (deprecated) */


/* child: urlbar is here, we modify it later, just reference */
/* #urlbar-container{} */


/* START: spring2 (deprecated) */


#customizableui-special-spring2 {
  display: none;
} 

/* END: spring2 (deprecated) */

/* #downloads-button {
} */

/* #unified-extensions-button {
} */

/* all pinnned extensions overflow here... */

/* settings menu */ 
#PanelUI-button {
  position: absolute !important;
  width: 30px !important;
  margin: 0px !important;
  padding-left: var(--fen-drawer-gap-x) !important;
}

#PanelUI-menu-button {
  width: 30px !important;
  margin: 0px !important;
  padding: 0px !important;
}

/* bookmarks area - always disable */
#PersonalToolbar {
  display: none;
}

/* ---- e:header ---- */



/* ---- s:urlbar ---- */

/* Pin Search Bar / Url bar above the sideberry tabs, and below the zen-sidebar top buttons */
#urlbar-container {
  position: absolute;
  width: 215px !important; 
  margin: 0px !important;
  margin-left: var(--fen-drawer-gap-x) !important;
  top: calc(42px + var(--fen-drawer-gap-y));
}

/* hide default url background unless active */
/* we use a custom background that tracks sidebar width*/
#urlbar:not(:is(
  [breakout-extend]
)) #urlbar-background {
  display: none !important;
}

/* when it pops out, position with respect to drawer gap */
#urlbar-background {
  margin-left: var(--fen-drawer-gap-x) !important;
  border-radius: 8px !important;
}

/* eager width adjustments for urlbar as sidebar width changes */
/* math - aesthetically urlbar width of 215 maps to a sidebar width of 224px */
/* 224 appears to be min-width default for sidebar */

/* selecting style instead of width because width isn't available at start */
/* 200s */
body:has(#browser > #sidebar-box[style*="; width: 23"]) #urlbar-container { width: 221px !important; }
body:has(#browser > #sidebar-box[style*="; width: 23"]) #urlbar-container { width: 221px !important; }
body:has(#browser > #sidebar-box[style*="; width: 24"]) #urlbar-container { width: 231px !important; }
body:has(#browser > #sidebar-box[style*="; width: 25"]) #urlbar-container { width: 241px !important; }
body:has(#browser > #sidebar-box[style*="; width: 26"]) #urlbar-container { width: 251px !important; }
body:has(#browser > #sidebar-box[style*="; width: 27"]) #urlbar-container { width: 261px !important; }
body:has(#browser > #sidebar-box[style*="; width: 28"]) #urlbar-container { width: 271px !important; }
body:has(#browser > #sidebar-box[style*="; width: 29"]) #urlbar-container { width: 281px !important; }

/* 300s */
body:has(#browser > #sidebar-box[style*="; width: 30"]) #urlbar-container { width: 291px !important; }
body:has(#browser > #sidebar-box[style*="; width: 31"]) #urlbar-container { width: 301px !important; }
body:has(#browser > #sidebar-box[style*="; width: 32"]) #urlbar-container { width: 311px !important; }
body:has(#browser > #sidebar-box[style*="; width: 33"]) #urlbar-container { width: 321px !important; }
body:has(#browser > #sidebar-box[style*="; width: 34"]) #urlbar-container { width: 331px !important; }
body:has(#browser > #sidebar-box[style*="; width: 35"]) #urlbar-container { width: 341px !important; }
body:has(#browser > #sidebar-box[style*="; width: 36"]) #urlbar-container { width: 351px !important; }
body:has(#browser > #sidebar-box[style*="; width: 37"]) #urlbar-container { width: 361px !important; }
body:has(#browser > #sidebar-box[style*="; width: 38"]) #urlbar-container { width: 371px !important; }
body:has(#browser > #sidebar-box[style*="; width: 39"]) #urlbar-container { width: 381px !important; }

/* 400s */
body:has(#browser > #sidebar-box[style*="; width: 40"]) #urlbar-container { width: 391px !important; }
body:has(#browser > #sidebar-box[style*="; width: 41"]) #urlbar-container { width: 401px !important; }
body:has(#browser > #sidebar-box[style*="; width: 42"]) #urlbar-container { width: 411px !important; }
body:has(#browser > #sidebar-box[style*="; width: 43"]) #urlbar-container { width: 421px !important; }
body:has(#browser > #sidebar-box[style*="; width: 44"]) #urlbar-container { width: 431px !important; }
body:has(#browser > #sidebar-box[style*="; width: 45"]) #urlbar-container { width: 441px !important; }
body:has(#browser > #sidebar-box[style*="; width: 46"]) #urlbar-container { width: 451px !important; }
body:has(#browser > #sidebar-box[style*="; width: 47"]) #urlbar-container { width: 461px !important; }
body:has(#browser > #sidebar-box[style*="; width: 48"]) #urlbar-container { width: 471px !important; }
body:has(#browser > #sidebar-box[style*="; width: 49"]) #urlbar-container { width: 481px !important; }

/* 500s */
body:has(#browser > #sidebar-box[style*="; width: 50"]) #urlbar-container { width: 491px !important; }
body:has(#browser > #sidebar-box[style*="; width: 51"]) #urlbar-container { width: 501px !important; }
body:has(#browser > #sidebar-box[style*="; width: 52"]) #urlbar-container { width: 511px !important; }
body:has(#browser > #sidebar-box[style*="; width: 53"]) #urlbar-container { width: 521px !important; }
body:has(#browser > #sidebar-box[style*="; width: 54"]) #urlbar-container { width: 531px !important; }
body:has(#browser > #sidebar-box[style*="; width: 55"]) #urlbar-container { width: 541px !important; }
body:has(#browser > #sidebar-box[style*="; width: 56"]) #urlbar-container { width: 551px !important; }
body:has(#browser > #sidebar-box[style*="; width: 57"]) #urlbar-container { width: 561px !important; }
body:has(#browser > #sidebar-box[style*="; width: 58"]) #urlbar-container { width: 571px !important; }
body:has(#browser > #sidebar-box[style*="; width: 59"]) #urlbar-container { width: 581px !important; }

/* 600 */
body:has(#browser > #sidebar-box[style*="; width: 6"]) #urlbar-container { width: 591px !important; }

/* set a minimum width for the url search */
#urlbar:is([focused][breakout-extend]) {
  width: 600px !important;
}

/* remove google icon crowding search bar */
#urlbar-searchmode-switcher {
  display: none;
}

/* shield icon for tracking protections, don't need */
/* TODO make this shown on hover, rather than always hide */
.urlbar-input-container #tracking-protection-icon-container {
  display: none;
}

/* the component selector this selector targets will show
   "Not secure" if the connection is not secure, 
   there is already an icon, only selectively hide if safe  */
/* #identity-icon-label {} */

/* shows "Sideberry" if on its extension page, not strictly needed */
/* #identity-box.extensionPage #identity-icon-label {
  display: none;
} */

/* shows Firefox if on settings, not strictly needed */
#identity-box.chromeUI #identity-icon-label {
  display: none;
}

/* align text with tabs */
box#identity-box.chromeUI {
  margin-right: 6px !important;
}

/* align tab and url text - on extension page */
box#identity-box.extensionPage {
  margin-right: 5px !important;
}
/* align tab and url text - when label text like not secure is present */
box#identity-box #identity-icon-label {
  margin-left: 6px !important;
}

/* align tab and url text - on verified pages */
box#identity-box.verifiedDomain {
  margin-right: 5px !important;
}

/* align url icon position with sideberry */
box#identity-icon-box {
  padding-left: 5px !important;
  padding-right: 5px !important;
}

/* warn if not secure */
body:has(#identity-box.notSecure) #identity-icon-label {
  color: red;
}
box#identity-box[pageproxystate="valid"].notSecureText box#identity-icon-label {
	display: block !important;
}
/* always shown identity-icon label if not secure */
box#identity-box[pageproxystate="valid"].notSecureText box#identity-icon-box {
  flex-shrink: 0 !important;
  min-width: 125px;
}


/* keep it dark, except when breakout-extend=true, maps to focused it looks like */
/* #urlbar:not([focused]) #identity-icon-box {
  background-color: #252528 !important;
} */
/* #urlbar:is([breakout-extend]) #identity-icon-box {
  background-color: #38383c !important;
} */

/*
FIREFOX SECURITY STATES REFERENCE

Reasonably safe to customize:
- .chromeUI          - Firefox internal pages
- .extensionPage     - Extension pages  
- .verifiedDomain    - HTTPS with valid cert
- .verifiedIdentity  - EV certificates

Preserve these (security warnings):
- .notSecure         - HTTP or broken HTTPS
- .insecureLoginForms - HTTPS page with HTTP login
- .mixedContentBlocked - HTTPS with blocked mixed content
- .mixedActiveContent  - HTTPS with active mixed content
*/

/* hide the packlock if not hovered and only if site is secure */
/* `.mixedContentBlocked` could be worth surfacing, for warnings */
/* but it seems like .notSecure is always concerning, so we will surface that */
/* #identity-box:not(.notSecure) {
  opacity: 1;
  transform: translateX(0);
  transition: opacity 0.3s ease, transform 0.3s ease;
}
#urlbar:not(:hover) #identity-box:not(.notSecure) {
  opacity: 0;
  transform: translateX(-20px); 
  pointer-events: none;
  width: 0px;
} */


body:has(#sidebar-box[hidden="true"]):has(#identity-box.notSecure)::before {
    content: "🦊 Fennec UI - HTTP Alert: Not Secure";
    text-align: center;
    font-size: 24px;
    margin-left: 0px;
    display: block;
    position: inherit;
    z-index: 3;
    width: 100%;
    height: 46px;
    padding-top: 8px;
    box-sizing: border-box;
    background-color: var(--fen-color);
}

/* remove from right-side of urlbar: favorite button, misc other things */
#page-action-buttons {
  display: none !important;
}


/* ---- e:urlbar ---- */



/* ---- s:sidebar ---- */

/* smallest width seems to be 224px */
/* style 1 - hide when all UI */
#sidebar-box {
  max-width: 600px !important;
  padding-left: var(--fen-drawer-gap-x);
  background-color: var(--fen-color) !important;
}

:root[titlepreface*="᠎"] {
  #sidebar-box {
    display: none !important;
  }
}

/* Remove the "Sideberry", "History", etc. sidepanel header  */
#sidebar-header {
  display: none;
}

/* create space for urlbar area inside the sidebar */
#sidebar-box::before {
  content: "";
  display: block;
  height: 100px;
  width: 100%;
  pointer-events: none;
  box-sizing: border-box;
  background-color: var(--fen-color);
  color: aliceblue;
}

/* custom urlbar background so its aligned with tabs */
#sidebar-box::after {
  content: "";
  position: absolute;
  top: calc(31px + var(--fen-header-height-y) - 0.5*var(--fen-urlbar-bg-height));
  height: var(--fen-urlbar-bg-height);
  width: calc(100% - var(--fen-drawer-gap-x));
  pointer-events: none;
  box-sizing: border-box;
  background-color: rgba(0,0,0,0.3);
  border-radius: 8px !important;
}

.sidebar-browser-stack {
  padding-bottom: var(--fen-drawer-gap-y)
}

/* panel#notification-popup {
  margin-left: 1px !important;
} */

/* fennec header divider when lwtheme is NOT present */
:root:not([lwtheme]) .sidebar-browser-stack::before {
  content: "";
  position: fixed;
  top: var(--fen-header-height-y);
  width: calc(100% - var(--fen-drawer-gap-x));
  height: 1px;
  background-color: var(--toolbarbutton-icon-fill);
  opacity: 0.3 !important;
  pointer-events: none;
  box-sizing: border-box;
}

/* increase ::before height if notifications are live */
/* body:has(#notifications-toolbar) {
  #sidebar-box::before {
    height: 300px;
  }
} */

#notifications-toolbar {
	position: absolute;
	top: 90px;
}


/* ------ s:sidebar-border ---- */ 

/* the gutter between the sidebar and page */
#sidebar-splitter {
  margin: 0px !important;
  width: var(--fen-drawer-gap-x);
  border: 0px !important;
  /* for theme support... */
  /* make top y% see-through, rest uses --fen-color */
  /* allows the splitter to be useable near nav buttons, 
     but stops it from clipping some backgrounds  */
  background-color: transparent !important;
  background-image: linear-gradient(
    to bottom,
    transparent 0%,
    transparent 5%,
    var(--fen-color) 5%,
    var(--fen-color) 100%
  ) !important;
  background-repeat: no-repeat !important;
}

/* style 1 - hide when all UI */
:root[titlepreface*="᠎"] {
  #sidebar-splitter {
    display: none !important;
  }
}

/* ------ e:sidebar-border ---- */ 


/* ------ s:sideberry ---- */
/* edits are handled in sideberry css file */
/* ------ e:sideberry ---- */


/* ---- e:sidebar ---- */
